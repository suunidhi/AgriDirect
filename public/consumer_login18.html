<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AgriDirect | Consumer Login</title>
  <style>
    body {font-family: Arial, sans-serif; background:#f6fff6; margin:0;}
    nav {
      display:flex; justify-content:space-between; align-items:center;
      background:#5D8736; padding:15px 30px; font-size: larger;
    }
    .logo {display:flex; align-items:center;}
    .logo video {width:50px;height:50px;margin-right:10px;border-radius:5px;}
    .logo-text {font-size:24px;font-weight:bold;color:#fff;}
    nav ul {list-style:none; display:flex;}
    nav ul li {margin:0 15px; padding:7px;}
    nav ul li a {text-decoration:none; color:#fff; font-weight:bold;}
    nav ul li a:hover {color:#F4FFC3;}

    .form-container {
      width:400px; margin:40px auto; background:white; padding:20px; border-radius:12px;
      box-shadow:0 4px 12px rgba(0,0,0,0.1);
      transition: transform 0.3s ease, background 0.3s ease;
      position: relative;
    }
    .form-container:hover { transform: scale(1.1); }
    h2 {text-align:center; color:#2e7d32;}
    label {display:block; margin-top:10px; font-weight:bold;}
    input {width:100%; padding:10px; margin-top:5px; border:1px solid #ccc; border-radius:8px;}
    button {
      background:#2e7d32; color:white; border:none; padding:12px; width:100%;
      border-radius:10px; margin-top:15px; cursor:pointer; font-size:1rem;
    }
    button:hover {background:#1b5e20;}
    .link {text-align:center; margin-top:10px;}

    #message {
      display:none;
      position:absolute;
      top:50%;
      left:50%;
      transform:translate(-50%, -50%);
      padding:15px 20px;
      border-radius:10px;
      font-weight:bold;
      text-align:center;
      z-index:1000;
    }
    #message.success {background:#d4edda; color:#155724;}
    #message.error {background:#f8d7da; color:#721c24;}
    #okBtn {margin-top:10px; padding:5px 15px; font-weight:bold; border:none; border-radius:5px; cursor:pointer;}

    footer {
      background:white; color:#809D3C; padding:30px 20px; text-align:center;
      border-top:2px solid #5D8736; margin-top:80px;
    }
    .footer-container {display:flex; justify-content:space-between; flex-wrap:wrap; max-width:1200px; margin:auto;}
    .footer-logo {display:flex; align-items:center; font-size:22px; font-weight:bold;}
    .footer-logo video {width:50px;height:50px;margin-right:10px;border-radius:5px;}
    .footer-social a img {width:30px;margin:0 10px;transition:transform 0.3s;}
    .footer-social a img:hover {transform:scale(1.2);}
    .footer-copy {margin-top:15px;font-size:14px;opacity:0.8;}
  </style>
</head>
<body>
  <!-- Navbar -->
    <nav>
      <div class="logo">
        <video autoplay loop muted>
          <source src="image/agridirect.mp4" type="video/mp4">
        </video>
        <span class="logo-text">AgriDirect</span>
      </div>
      <ul>
        <li><a href="shared_homepage.html">HOME</a></li>
        <li><a href="marketplace.html">MARKETPLACE</a></li>
        <li><a id="dashboardLink" href="#">DASHBOARD</a></li>
        <li><a href="about_us.html">ABOUT US</a></li>
        <li><a id="authLink" href="role.html">LOGIN/SIGN UP</a></li>
      </ul>
    </nav>
  <!-- Login Form -->
  <div class="form-container">
    <h2>Consumer Login</h2>
    <form id="consumerLoginForm">
      <label>Full Name</label>
      <input type="text" name="name" required>
      <label>Email</label>
      <input type="email" name="email" required>
      <label>Password</label>
      <input type="password" name="password" minlength="6" required>
      <button type="submit">Login</button>
    </form>
    <div class="link">New Customer? <a href="consumer_signup18.html">Register</a></div>

    <div id="message">
      <span id="messageText"></span>
      <button id="okBtn">OK</button>
    </div>
  </div>

  <!-- Footer -->
  <footer>
    <div class="footer-container">
      <div class="footer-logo">
        <video autoplay loop muted playsinline>
          <source src="image/logo.mp4" type="video/mp4">
        </video>
        <span>AgriDirect</span>
      </div>
      <div class="footer-contact">
        <h3>Contact Us</h3>
        <p>Email: support@agriDirect.com</p>
        <p>Phone: +91 10101 01010</p>
      </div>
      <div class="footer-social">
        <h3>Follow Us</h3>
        <a href="#"><img src="image/linkedin.png" alt="LinkedIn"></a>
        <a href="#"><img src="image/twitter.png" alt="Twitter"></a>
        <a href="#"><img src="image/instagram.png" alt="Instagram"></a>
        <a href="#"><img src="image/youtube.png" alt="YouTube"></a>
      </div>
    </div>
    <p class="footer-copy">&copy; 2025 Agridirect. All Rights Reserved.</p>
  </footer>

  <!-- ✅ Login Logic -->
  <script>
  const loginForm = document.getElementById("consumerLoginForm");
  const messageDiv = document.getElementById("message");
  const messageText = document.getElementById("messageText");
  const okBtn = document.getElementById("okBtn");

  loginForm.addEventListener("submit", async function(e){
    e.preventDefault();

    const formData = new FormData(loginForm);
    const dataObj = {};
    formData.forEach((value,key) => dataObj[key] = value);

    try {
      const res = await fetch("http://localhost:5000/consumer/login", {
        method:"POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify(dataObj)
      });

      const data = await res.json();

      messageText.innerText = data.message || "Login status unknown!";
      messageDiv.className = data.status || "success";
      messageDiv.style.display = "block";

if ((data.status && data.status.toLowerCase() === "success") || data.success) {
  if (data.consumer) {
    // ✅ Store login session info
    localStorage.setItem("userRole", "consumer");
    localStorage.setItem("consumerId", data.consumer._id);
    localStorage.setItem("consumerName", data.consumer.name);
    localStorage.setItem("consumerEmail", data.consumer.email);
    localStorage.setItem("consumerMobile", data.consumer.mobile || "");

    // ✅ Get checkout data (if any)
    const checkoutProduct = JSON.parse(localStorage.getItem("checkoutProduct") || "{}");

    // Hide popup before redirect
    messageDiv.style.display = "none";

    if (checkoutProduct && checkoutProduct.productId) {
      // ✅ Redirect to checkout with all details
      window.location.href = `checkout.html?productId=${encodeURIComponent(checkoutProduct.productId)}&farmerId=${encodeURIComponent(checkoutProduct.farmerId)}&name=${encodeURIComponent(checkoutProduct.name)}&price=${encodeURIComponent(checkoutProduct.price)}&consumerId=${encodeURIComponent(data.consumer._id)}`;
    } else {
      // ✅ Redirect to dashboard if no product in checkout
      window.location.href = "consumer_dashboard.html";
    }
  }
}

      else {
        okBtn.style.display = "inline-block";
        okBtn.onclick = function(){ messageDiv.style.display = "none"; };
      }

    } catch(err){
      console.error(err);
      messageText.innerText = "Server error!";
      messageDiv.className = "error";
      messageDiv.style.display = "block";
      okBtn.style.display = "inline-block";
      okBtn.onclick = function(){ messageDiv.style.display = "none"; };
    }
  });
// ✅ Navbar role-based logic
  document.addEventListener("DOMContentLoaded", () => {
    const dashboardLink = document.getElementById("dashboardLink");
    const authLink = document.getElementById("authLink");

    const userRole = localStorage.getItem("userRole");
    const consumerName = localStorage.getItem("consumerName");
    const farmerName = localStorage.getItem("farmerName");

    if (userRole === "farmer") {
      dashboardLink.href = "marketplacefarmer.html";
      authLink.textContent = `LOGOUT`;
      authLink.href = "#";
      authLink.onclick = () => {
        localStorage.clear();
        alert("Logged out successfully!");
        window.location.href = "shared_homepage.html";
      };
    } else if (userRole === "consumer") {
      dashboardLink.href = "consumer_dashboard.html";
      authLink.textContent = `LOGOUT `;
      authLink.href = "#";
      authLink.onclick = () => {
        localStorage.clear();
        alert("Logged out successfully!");
        window.location.href = "shared_homepage.html";
      };
    } else {
      dashboardLink.href = "role.html";
      authLink.textContent = "LOGIN/SIGN UP";
      authLink.href = "role.html";
    }
  });
  </script>
</body>
</html>
