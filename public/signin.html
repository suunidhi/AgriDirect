<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Consumer Sign Up - AgriDirect</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
<style>
body {
    font-family: 'Montserrat', sans-serif;
    background: url('agri.webp') no-repeat center center/cover;
    backdrop-filter: blur(8px);
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    margin: 0;
}
.container {
    background: #fff;
    padding: 30px;
    border-radius: 12px;
    box-shadow: 0 6px 20px rgba(0,0,0,0.2);
    width: 100%;
    max-width: 450px;
}
h2 { text-align: center; color: #2e7d32; margin-bottom: 20px; }
label { font-weight: 600; margin-top: 10px; display: block; }
input, textarea {
    width: 100%;
    padding: 10px;
    margin-top: 6px;
    border-radius: 6px;
    border: 1px solid #ccc;
    font-size: 14px;
}
button {
    margin-top: 15px;
    padding: 12px;
    width: 100%;
    background: #4CAF50;
    color: #fff;
    border: none;
    border-radius: 6px;
    font-size: 16px;
    cursor: pointer;
    transition: 0.3s;
}
button:hover { background: #388E3C; }
p#error { color: red; text-align: center; margin-top: 10px; }
p#success { color: green; text-align: center; margin-top: 10px; }
</style>
</head>
<body>
<div class="container">
    <h2>Consumer Sign Up</h2>
    <form id="signup-form">
        <label for="name">Full Name:</label>
        <input type="text" id="name" name="name" required placeholder="Enter your full name" minlength="3">

        <label for="email">Email:</label>
        <input type="email" id="email" name="email" required placeholder="Enter your email">

        <label for="password">Password:</label>
        <input type="password" id="password" name="password" required placeholder="Enter a password" minlength="6">

        <label for="mobile">Mobile Number:</label>
        <input type="tel" id="mobile" name="mobile" required pattern="[0-9]{10}" placeholder="Enter 10-digit mobile number">

        <label for="address">Address:</label>
        <textarea id="address" name="address" required placeholder="Enter your full address" minlength="10"></textarea>

        <button type="submit">Sign Up</button>
    </form>
    <p id="error"></p>
    <p id="success"></p>
</div>

<script>
const form = document.getElementById('signup-form');
const errorP = document.getElementById('error');
const successP = document.getElementById('success');

form.addEventListener('submit', async (e) => {
    e.preventDefault();
    errorP.innerText = '';
    successP.innerText = '';

    const name = document.getElementById('name').value.trim();
    const email = document.getElementById('email').value.trim();
    const password = document.getElementById('password').value.trim();
    const mobile = document.getElementById('mobile').value.trim();
    const address = document.getElementById('address').value.trim();

    // Basic front-end validation
    if (name.length < 3) return errorP.innerText = "Name must be at least 3 characters.";
    if (password.length < 6) return errorP.innerText = "Password must be at least 6 characters.";
    if (!/^\d{10}$/.test(mobile)) return errorP.innerText = "Enter a valid 10-digit mobile number.";
    if (address.length < 10) return errorP.innerText = "Address must be at least 10 characters.";

    try {
        const response = await fetch('/signup', {
            method: 'POST',
            headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
            body: new URLSearchParams({ name, email, password, mobile, address })
        });

        const text = await response.text();

        if (response.ok) {
            successP.innerText = 'Signup successful! Redirecting to login...';
            setTimeout(() => window.location.href = 'login187.html', 1500);
        } else {
            errorP.innerHTML = text;
        }
    } catch (err) {
        errorP.innerText = 'Server error. Try again later.';
    }
});

        document.addEventListener("DOMContentLoaded", () => {
  const loginMenuItem = document.querySelector("nav ul li a[href='role.html']");

  // Check login status
  const farmerId = localStorage.getItem("farmerId");
  const consumerId = localStorage.getItem("consumerId");

  if (farmerId || consumerId) {
    // ✅ Change "Login/Sign Up" → "Logout"
    loginMenuItem.textContent = "LOGOUT";
    loginMenuItem.href = "#";
    loginMenuItem.addEventListener("click", () => {
      // Confirm logout
      if (confirm("Are you sure you want to log out?")) {
        localStorage.clear(); // Clear all session info
        alert("Logged out successfully!");
        window.location.href = "shared_homepage.html"; // Redirect to homepage
      }
    });
  }
});
// ✅ Navbar role-based logic
  document.addEventListener("DOMContentLoaded", () => {
    const dashboardLink = document.getElementById("dashboardLink");
    const authLink = document.getElementById("authLink");

    const userRole = localStorage.getItem("userRole");
    const consumerName = localStorage.getItem("consumerName");
    const farmerName = localStorage.getItem("farmerName");

    if (userRole === "farmer") {
      dashboardLink.href = "farmermarketplace.html";
      authLink.textContent = `LOGOUT`;
      authLink.href = "#";
      authLink.onclick = () => {
        localStorage.clear();
        alert("Logged out successfully!");
        window.location.href = "shared_homepage.html";
      };
    } else if (userRole === "consumer") {
      dashboardLink.href = "consumer_dashboard.html";
      authLink.textContent = `LOGOUT `;
      authLink.href = "#";
      authLink.onclick = () => {
        localStorage.clear();
        alert("Logged out successfully!");
        window.location.href = "shared_homepage.html";
      };
    } else {
      dashboardLink.href = "role.html";
      authLink.textContent = "LOGIN/SIGN UP";
      authLink.href = "role.html";
    }
  });
</script>
</body>
</html>
